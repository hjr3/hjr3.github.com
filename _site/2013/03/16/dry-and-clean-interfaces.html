<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en-us">
<head>
   <meta http-equiv="content-type" content="text/html; charset=utf-8" />
   <title>DRY and Clean Interfaces</title>
   <meta name="author" content="Herman J. Radtke III" />

   <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
</head>
<body>

<h1 id='dry_and_clean_interfaces'>DRY and Clean Interfaces</h1>

<p>The principle of Don&#8217;t Repeat Yourself (DRY) is more than just grouping common code together. When trying to apply the DRY principle, it is easy to start making a mess of a class interface. I recently had to write some code to generate Flickr image URLs from an API response. I needed to generate two types of URLs: a thumbnail and a normal image. Here is one version of code reuse:</p>
<div class='highlight'><pre><code class='objective-c'><span class='k'>-</span> <span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span><span class='nf'>generateFlickrImageUrl:</span><span class='p'>(</span><span class='n'>NSDictionary</span> <span class='o'>*</span><span class='p'>)</span><span class='nv'>photo</span> <span class='nf'>withImageType:</span><span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span> <span class='n'>imageType</span>
<span class='p'>{</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>imageSize</span><span class='p'>;</span>

    <span class='k'>if</span> <span class='p'>([</span><span class='n'>imageType</span> <span class='n'>isEqualToString</span><span class='o'>:</span><span class='s'>@&quot;thumbnail&quot;</span><span class='p'>])</span> <span class='p'>{</span>
        <span class='n'>imageSize</span> <span class='o'>=</span> <span class='s'>@&quot;t&quot;</span><span class='p'>;</span>
    <span class='p'>}</span> <span class='k'>else</span> <span class='p'>{</span>
        <span class='n'>imageSize</span> <span class='o'>=</span> <span class='s'>@&quot;z&quot;</span><span class='p'>;</span>
    <span class='p'>}</span>

    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>farm</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;farm&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>server</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;server&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>photoId</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;id&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>secret</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;secret&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>url</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSString</span> <span class='n'>stringWithFormat</span><span class='o'>:</span><span class='s'>@&quot;http://farm%@.staticflickr.com/%@/%@_%@_%@.jpg&quot;</span><span class='p'>,</span> <span class='n'>farm</span><span class='p'>,</span> <span class='n'>server</span><span class='p'>,</span> <span class='n'>photoId</span><span class='p'>,</span> <span class='n'>secret</span><span class='p'>,</span> <span class='n'>imageSize</span><span class='p'>];</span>
    
    <span class='k'>return</span> <span class='n'>url</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre></div>
<p>While this does reuse code, it is bad because the code is not accepting of change. If I have to add some other sort of image type, then I have to modify this function. This is a big red flag. When you start using method parameters as an extension of your interface, you may be making the code hard to change. Also, anyone using this class will have to look for the list of available options for the <code>imageType</code> parameter. I think it is better to design a easy to understand interface instead.</p>
<div class='highlight'><pre><code class='objective-c'><span class='k'>-</span> <span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span><span class='nf'>generateFlickrImageUrl:</span><span class='p'>(</span><span class='n'>NSDictionary</span> <span class='o'>*</span><span class='p'>)</span><span class='nv'>photo</span> <span class='nf'>withImageSize:</span><span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span> <span class='n'>imageSize</span>
<span class='p'>{</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>farm</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;farm&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>server</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;server&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>photoId</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;id&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>secret</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>photo</span> <span class='n'>valueForKey</span><span class='o'>:</span><span class='s'>@&quot;secret&quot;</span><span class='p'>];</span>
    <span class='n'>NSString</span> <span class='o'>*</span><span class='n'>url</span> <span class='o'>=</span> <span class='p'>[</span><span class='n'>NSString</span> <span class='n'>stringWithFormat</span><span class='o'>:</span><span class='s'>@&quot;http://farm%@.staticflickr.com/%@/%@_%@_%@.jpg&quot;</span><span class='p'>,</span> <span class='n'>farm</span><span class='p'>,</span> <span class='n'>server</span><span class='p'>,</span> <span class='n'>photoId</span><span class='p'>,</span> <span class='n'>secret</span><span class='p'>,</span> <span class='n'>imageSize</span><span class='p'>];</span>
    
    <span class='k'>return</span> <span class='n'>url</span><span class='p'>;</span>
<span class='p'>}</span>

<span class='o'>-</span> <span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span><span class='n'>generateImageUrlThumbnail</span><span class='o'>:</span><span class='p'>(</span><span class='n'>NSDictionary</span> <span class='o'>*</span><span class='p'>)</span><span class='n'>photo</span>
<span class='p'>{</span>
    <span class='k'>return</span> <span class='p'>[</span><span class='n'>self</span> <span class='n'>generateFlickrImageUrl</span><span class='o'>:</span><span class='n'>photo</span> <span class='n'>withImageSize</span><span class='o'>:</span><span class='s'>@&quot;t&quot;</span><span class='p'>];</span>
<span class='p'>}</span>

<span class='o'>-</span> <span class='p'>(</span><span class='n'>NSString</span> <span class='o'>*</span><span class='p'>)</span><span class='n'>generateImageUrl</span><span class='o'>:</span><span class='p'>(</span><span class='n'>NSDictionary</span> <span class='o'>*</span><span class='p'>)</span><span class='n'>photo</span>
<span class='p'>{</span>
    <span class='k'>return</span> <span class='p'>[</span><span class='n'>self</span> <span class='n'>generateFlickrImageUrl</span><span class='o'>:</span><span class='n'>photo</span> <span class='n'>withImageSize</span><span class='o'>:</span><span class='s'>@&quot;z&quot;</span><span class='p'>];</span>
<span class='p'>}</span>
</code></pre></div>
<p>The <code>generateFlickrImageUrl</code> is now a protected method of the class while the <code>generateImageUrl</code> and <code>generateImageUrlThumbnail</code> methods define the public interface.</p>

</body>
</html>
